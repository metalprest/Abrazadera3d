<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Visor 3D – Menú colapsable</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    :root{
      --green:#22e26d;
      --btn-bg:#111;
      --btn-bd:#2a2a2a;
      --panelW: 240px;
    }
    /* Tipografía + base */
    html, body{
      margin:0; height:100%;
      background:#000;
      font-family: "Century Gothic", CenturyGothic, "URW Gothic L",
                   "Segoe UI", Arial, Helvetica, sans-serif;
    }
    model-viewer{
      position:fixed; inset:0;
      width:100%; height:100vh; background:#000;
      /* en desktop, dejamos espacio para el panel cuando esté abierto */
      transition: margin-left .25s ease;
    }

    /* Botón flotante (hamburger) */
    .fab{
      position:fixed; top:12px; left:12px; z-index:20;
      width:42px; height:42px; border-radius:10px;
      display:grid; place-items:center;
      background:#111; color:#fff; border:1px solid #2a2a2a;
      cursor:pointer; font-size:22px; line-height:0;
      box-shadow:0 4px 14px #0007;
      transition:background .15s, transform .2s;
    }
    .fab:hover{ background:#1a1a1a }
    .fab.hide{ transform: translateX(calc(var(--panelW) - 30px)); }

    /* Panel lateral (overlay en mobile) */
    aside#panel{
      position:fixed; top:0; left:0; bottom:0; z-index:25;
      width:var(--panelW);
      padding:12px;
      display:flex; flex-direction:column; gap:8px;
      background:#000f; backdrop-filter: blur(6px);
      border-right:1px solid #1c1c1c;
      transform: translateX(-100%);
      transition: transform .25s ease;
      box-sizing:border-box;
    }
    aside#panel.open{ transform: translateX(0); }

    /* Scrim para cerrar tocando fuera (solo móvil) */
    .scrim{
      position:fixed; inset:0; z-index:24;
      background:#0008; opacity:0; pointer-events:none;
      transition:opacity .2s ease;
    }
    .scrim.show{ opacity:1; pointer-events:auto; }

    /* Cabecera del panel (opcional) */
    .title{ color:#fff; font-weight:700; margin:0 0 6px 2px; opacity:.9; }

    /* Botones */
    .btn{
      appearance:none;
      border:1px solid var(--btn-bd);
      background:var(--btn-bg);
      color:#fff;
      padding:.6rem .75rem;
      border-radius:.6rem;
      cursor:pointer; font-weight:600; text-align:left;
      transition: background .15s, color .15s, box-shadow .15s, border-color .15s;
    }
    .btn:hover, .btn:focus-visible{
      background:var(--green); color:#000; outline:none;
      border-color: var(--green);
      box-shadow: 0 0 0 2px color-mix(in oklab, var(--green) 55%, #000 45%) inset;
    }
    .btn.active{
      background:var(--green); color:#000;
      border-color: var(--green);
      box-shadow: 0 0 0 2px color-mix(in oklab, var(--green) 55%, #000 45%) inset;
    }
    .spacer{ flex:1 1 auto; }
    .tools{ display:flex; flex-direction:column; gap:8px; margin-top:auto; }

    /* Desktop: panel abierto por defecto y empuja el viewer */
    @media (min-width: 900px){
      aside#panel{ transform: translateX(0); }
      model-viewer.with-panel{ margin-left: var(--panelW); }
      .scrim{ display:none; }
      .fab.hide{ transform:none; } /* no escondemos en desktop */
    }
  </style>
</head>
<body>

  <!-- Botón hamburguesa -->
  <button id="toggle" class="fab" aria-label="Abrir menú" aria-expanded="false">☰</button>

  <!-- Panel y scrim -->
  <aside id="panel" aria-label="Selector de modelos">
    <h3 class="title">Modelos</h3>
    <button class="btn" data-file="parte_derecha.glb">Parte derecha</button>
    <button class="btn" data-file="parte_izquerda.glb">Parte izquierda</button>
    <button class="btn" data-file="pieza_completa.glb">Pieza completa</button>

    <div class="spacer"></div>
    <div class="tools">
      <button id="toggle-rotate" class="btn">⟳ Auto-rotate</button>
      <button id="reset" class="btn">↺ Reset</button>
    </div>
  </aside>
  <div id="scrim" class="scrim" aria-hidden="true"></div>

  <!-- Visor -->
  <model-viewer id="mv"
    src=""
    alt="Modelo 3D"
    camera-controls
    auto-rotate
    interaction-prompt="auto"
    shadow-intensity="0.8"
    exposure="1"
    loading="eager"
    reveal="auto"
    style="--poster-color: transparent;">
  </model-viewer>

  <script>
    const mv = document.getElementById('mv');
    const buttons = Array.from(document.querySelectorAll('button[data-file]'));
    const btnRotate = document.getElementById('toggle-rotate');
    const btnReset = document.getElementById('reset');
    const panel = document.getElementById('panel');
    const toggle = document.getElementById('toggle');
    const scrim = document.getElementById('scrim');
    const mql = window.matchMedia('(min-width: 900px)');

    // cache-busting para forzar recarga del GLB
    const bust = (url) => `${url}${url.includes('?') ? '&' : '?'}v=${Date.now()}`;

    function setActive(btn){
      buttons.forEach(b => b.classList.toggle('active', b === btn));
    }
    function loadModel(file){
      const src = bust(file);
      mv.src = '';
      requestAnimationFrame(() => { mv.src = src; });
      localStorage.setItem('lastModel', file);

      // En móvil, al elegir modelo cerramos el panel para dejar pantalla libre
      if (!mql.matches) closePanel();
    }

    // Toggle panel
    function openPanel(){
      panel.classList.add('open');
      toggle.setAttribute('aria-expanded', 'true');
      // en mobile mostramos scrim y movemos el FAB hacia la derecha
      if (!mql.matches){
        scrim.classList.add('show');
        toggle.classList.add('hide');
      }
    }
    function closePanel(){
      panel.classList.remove('open');
      toggle.setAttribute('aria-expanded', 'false');
      if (!mql.matches){
        scrim.classList.remove('show');
        toggle.classList.remove('hide');
      }
    }
    function togglePanel(){
      panel.classList.contains('open') ? closePanel() : openPanel();
    }

    toggle.addEventListener('click', togglePanel);
    scrim.addEventListener('click', closePanel);

    // Botones de modelo
    buttons.forEach(btn => {
      btn.addEventListener('click', () => {
        setActive(btn);
        loadModel(btn.dataset.file);
      });
    });

    // Auto-rotate ON/OFF
    btnRotate.addEventListener('click', () => {
      if (mv.hasAttribute('auto-rotate')) {
        mv.removeAttribute('auto-rotate');
        btnRotate.textContent = '⟳ Auto-rotate (off)';
      } else {
        mv.setAttribute('auto-rotate', '');
        btnRotate.textContent = '⟳ Auto-rotate';
      }
    });

    // Reset vista
    btnReset.addEventListener('click', () => {
      const current = localStorage.getItem('lastModel') || buttons[0].dataset.file;
      loadModel(current);
    });

    // Estado inicial
    function applyDesktopLayout(){
      // En desktop mostramos panel y empujamos el viewer
      panel.classList.add('open');
      mv.classList.add('with-panel');
      scrim.classList.remove('show');
    }
    function applyMobileLayout(){
      // En móvil arrancamos con panel cerrado y viewer a pantalla completa
      panel.classList.remove('open');
      mv.classList.remove('with-panel');
      scrim.classList.remove('show');
    }
    function updateLayout(e){
      e.matches ? applyDesktopLayout() : applyMobileLayout();
    }
    mql.addEventListener?.('change', updateLayout);
    updateLayout(mql); // aplicar al cargar

    // Carga modelo inicial
    const initial = localStorage.getItem('lastModel') || buttons[0].dataset.file;
    const initialBtn = buttons.find(b => b.dataset.file === initial) || buttons[0];
    setActive(initialBtn);
    loadModel(initial);
  </script>
</body>
</html>
